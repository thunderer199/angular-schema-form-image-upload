angular.module('templates', []).run(['$templateCache', function($templateCache) {$templateCache.put('src/templates/image-url.html','<div ng-if="form.readonly && $$value$$ && $$value$$.length > 0"\n     class="panel panel-default schema-form-{{form.type}} {{form.htmlClass}}">\n  <div class="panel-heading">\n    <label ng-show="showTitle()">{{form.title}}</label>\n  </div>\n\n  <div class="panel-body">\n    <img class="img-responsive" ng-src="{{$$value$$}}" alt="">\n\n    <button ng-if="form.description" class="btn btn-default pull-right"\n            ng-click="tab.show_index = !tab.show_index ? $index : tab.show_index !== $index ? $index : null">\n      <i class="glyphicon glyphicon-question-sign"></i>\n    </button>\n  </div>\n\n  <div class="panel-footer" ng-if="form.feedback || (form.description && tab.show_index === $index )">\n    <span ng-if="form.feedback !== false" class="form-control-feedback" aria-hidden="true"></span>\n    <div ng-show="tab.show_index === $index" class="help-block" sf-message="form.description"></div>\n  </div>\n</div>\n\n<div class="form-group schema-form-{{form.type}} {{form.htmlClass}}"\n     ng-if="!form.readonly"\n     ng-class="{\'has-error\': form.disableErrorState !== true && hasError(), \'has-success\': form.disableSuccessState !== true && hasSuccess(), \'has-feedback\': form.feedback !== false }">\n  <label class="control-label {{form.labelHtmlClass}}" ng-class="{\'sr-only\': !showTitle()}"\n         for="{{form.key.slice(-1)[0]}}">{{form.title}}</label>\n\n  <div ng-class="{\'input-group\': form.description || hasSuccess() }"\n       ng-if="!form.fieldAddonLeft && !form.fieldAddonRight">\n\n    <input ng-if="!form.fieldAddonLeft && !form.fieldAddonRight"\n           ng-show="form.key"\n           type="{{form.type}}"\n           step="any"\n           sf-changed="form"\n           placeholder="{{form.placeholder}}"\n           class="form-control {{form.fieldHtmlClass}}"\n           id="{{form.key.slice(-1)[0]}}"\n           ng-model-options="form.ngModelOptions"\n           ng-model="$$value$$"\n           ng-disabled="form.readonly"\n           schema-validate="form"\n           name="{{form.key.slice(-1)[0]}}"\n           aria-describedby="{{form.key.slice(-1)[0] + \'Status\'}}">\n\n    <span class="input-group-btn">\n            <button class="btn btn-default" ng-if="hasSuccess() && form.feedback !== false" disabled="disabled">\n                <i class="glyphicon glyphicon-ok" style="color: #3c763d;"></i>\n            </button>\n            <button ng-if="form.description" class="btn btn-default"\n                    ng-click="tab.show_index = !tab.show_index ? $index : tab.show_index !== $index ? $index : null">\n                <i class="glyphicon glyphicon-question-sign"></i>\n            </button>\n        </span>\n\n  </div>\n\n  <!--<img class="img-thumbnail" ng-show="form.key" ng-src="{{$$value$$}}" alt="" width="{{form.preview.width}}"-->\n  <!--height="{{form.preview.height}}">-->\n\n  <button class="btn btn-default" ng-click="addImage();" ng-show="!readOnly">\n    <i class="glyphicon glyphicon-plus-sign"></i>&nbsp;<span>Add image</span>\n  </button>\n\n  <div ng-if="form.fieldAddonLeft || form.fieldAddonRight"\n       ng-class="{\'input-group\': (form.fieldAddonLeft || form.fieldAddonRight)}">\n        <span ng-if="form.fieldAddonLeft"\n              class="input-group-addon"\n              ng-bind-html="form.fieldAddonLeft"></span>\n\n    <input ng-show="form.key"\n           type="{{form.type}}"\n           step="any"\n           sf-changed="form"\n           placeholder="{{form.placeholder}}"\n           class="form-control {{form.fieldHtmlClass}}"\n           id="{{form.key.slice(-1)[0]}}"\n           ng-model-options="form.ngModelOptions"\n           ng-model="$$value$$"\n           ng-disabled="form.readonly"\n           schema-validate="form"\n           name="{{form.key.slice(-1)[0]}}"\n           aria-describedby="{{form.key.slice(-1)[0] + \'Status\'}}">\n\n    <span class="input-group-btn">\n            <button class="btn btn-default" ng-if="hasSuccess() && form.feedback !== false" disabled="disabled">\n                <i class="glyphicon glyphicon-ok" style="color: #3c763d;"></i>\n            </button>\n\n            <button ng-if="form.description" class="btn btn-default"\n                    ng-click="tab.show_index = !tab.show_index ? $index : tab.show_index !== $index ? $index : null">\n                <i class="glyphicon glyphicon-question-sign"></i>\n            </button>\n\n\n        </span>\n\n    <img class="img-thumbnail" ng-show="form.key" ng-src="{{$$value$$}}" alt="" width="{{form.preview.width}}"\n         height="{{form.preview.height}}">\n\n    <span ng-if="form.fieldAddonRight"\n          class="input-group-addon"\n          ng-bind-html="form.fieldAddonRight"></span>\n  </div>\n\n  <span ng-if="hasError() || hasSuccess()"\n        id="{{form.key.slice(-1)[0] + \'Status\'}}"\n        class="sr-only">{{ hasSuccess() ? \'(success)\' : \'(error)\' }}</span>\n\n  <div ng-show="$index === tab.show_index" class="help-block" sf-message="form.description"></div>\n</div>');}]);
angular.module('imageUrl', [
  'schemaForm',
  'templates'
]).config(function(schemaFormDecoratorsProvider, sfBuilderProvider) {

  schemaFormDecoratorsProvider.defineAddOn(
    'bootstrapDecorator',           // Name of the decorator you want to add to.
    'image-url',                      // Form type that should render this add-on
    'src/templates/image-url.html',  // Template name in $templateCache
    sfBuilderProvider.stdBuilders   // List of builder functions to apply.
  );

});

angular.module('imageUrl').directive('imageUrl', function () {
  return {
    restrict: 'E',
    require: 'ngModel',
    scope: {},
    template: '<input type="text" class="form-control" ng-model="modelValue" ng-blur="updateModel(modelValue)"></input>',
    link: function (scope, element, attrs, ngModel) {
      scope.modelValue = ngModel.$viewValue;

      scope.updateModel = function (modelValue) {
        ngModel.$setViewValue(modelValue);
      };
    },
  };
});
