angular.module("templates",[]).run(["$templateCache",function(n){n.put("src/dialogs/confirm.html",'<div class="dialog">\n  <div class="modal-header">\n    <h3 class="modal-title">{{title}}</h3>\n  </div>\n  <div class="modal-body">\n    {{question}}\n  </div>\n  <div class="modal-footer">\n    <button class="btn btn-primary" ng-click="ok()">Ok</button>\n    <button class="btn btn-warning" ng-click="cancel()">Cancel</button>\n  </div>\n</div>'),n.put("src/dialogs/show-img.html",'<div class="dialog">\n  <div class="modal-header">\n    <h3 class="modal-title">{{title}}</h3>\n  </div>\n  <div class="modal-body">\n    <img class="img-thumbnail" ng-src="{{url}}" alt=""/>\n  </div>\n  <div class="modal-footer">\n    <button class="btn btn-default" ng-click="download()">Download Image</button>\n    <button class="btn btn-warning" ng-click="cancel()">Ok</button>\n  </div>\n</div>'),n.put("src/templates/image-url-plugin.html",'<div ng-if="form.readonly && $$value$$ && $$value$$.length > 0"\n     class="panel panel-default schema-form-{{form.type}} {{form.htmlClass}}">\n  <div class="panel-heading">\n    <label ng-show="showTitle()">{{form.title}}</label>\n  </div>\n\n  <div class="panel-body">\n    <img class="img-responsive" ng-src="{{$$value$$}}" alt="">\n\n    <button ng-if="form.description" class="btn btn-default pull-right"\n            ng-click="tab.show_index = !tab.show_index ? $index : tab.show_index !== $index ? $index : null">\n      <i class="glyphicon glyphicon-question-sign"></i>\n    </button>\n  </div>\n\n  <div class="panel-footer" ng-if="form.feedback || (form.description && tab.show_index === $index )">\n    <span ng-if="form.feedback !== false" class="form-control-feedback" aria-hidden="true"></span>\n    <div ng-show="tab.show_index === $index" class="help-block" sf-message="form.description"></div>\n  </div>\n</div>\n\n<div class="form-group schema-form-{{form.type}} {{form.htmlClass}}"\n     ng-class="{\'has-error\': form.disableErrorState !== true && hasError(), \'has-success\': form.disableSuccessState !== true && hasSuccess(), \'has-feedback\': form.feedback !== false }">\n  <label class="control-label {{form.labelHtmlClass}}" ng-class="{\'sr-only\': !showTitle()}"\n         for="{{form.key.slice(-1)[0]}}" >{{form.title}}</label>\n\n  <div ng-class="{\'input-group\': form.description || hasSuccess() }"\n       ng-if="!form.fieldAddonLeft && !form.fieldAddonRight">\n\n    <image-url schema="schema" form="form" model="$$value$$"></image-url>\n\n  </div>\n\n  <div ng-if="form.fieldAddonLeft || form.fieldAddonRight"\n       ng-class="{\'input-group\': (form.fieldAddonLeft || form.fieldAddonRight)}">\n        <span ng-if="form.fieldAddonLeft"\n              class="input-group-addon"\n              ng-bind-html="form.fieldAddonLeft"></span>\n\n    <image-url schema="schema" form="form" model="$$value$$"></image-url>\n\n    <span ng-if="form.fieldAddonRight"\n          class="input-group-addon"\n          ng-bind-html="form.fieldAddonRight"></span>\n  </div>\n\n  <span ng-if="hasError() || hasSuccess()"\n        id="{{form.key.slice(-1)[0] + \'Status\'}}"\n        class="sr-only">{{ hasSuccess() ? \'(success)\' : \'(error)\' }}</span>\n\n  <div ng-show="$index === tab.show_index" class="help-block" sf-message="form.description"></div>\n</div>'),n.put("src/templates/image-url.html",'<div>\n  <div ng-if="model && model.images" ng-repeat="modelOne in model.images track by $index">\n    <div class="input-group">\n      <span class="input-group-addon">{{$index + 1}}</span>\n      <input ng-show="form.key"\n             type="{{form.type}}"\n             step="any"\n             sf-changed="form"\n             placeholder="{{form.placeholder}}"\n             class="form-control {{form.fieldHtmlClass}}"\n             id="{{form.key.slice(-1)[0]}}"\n             ng-model-options="form.ngModelOptions"\n             ng-model="modelOne.url"\n             ng-disabled="form.readonly"\n             name="{{form.key.slice(-1)[0]}}"\n             aria-describedby="{{form.key.slice(-1)[0] + \'Status\'}}" />\n      <div class="input-group-btn" ng-if="!form.readonly">\n        <button class="btn btn-default" data-toggle="tooltip"\n                title="move up"\n                ng-click="moveElement($index, -1)"\n                ng-disabled="$index === 0">\n          <i class="glyphicon glyphicon-chevron-up"></i>\n        </button>\n        <button class="btn btn-default"\n                data-toggle="tooltip"\n                title="move down"\n                ng-click="moveElement($index, 1)"\n                ng-disabled="$index === model.images.length -1">\n          <i class="glyphicon glyphicon-chevron-down"></i>\n        </button>\n        <button type="file" class="btn btn-primary"\n                data-toggle="tooltip"\n                title="upload to server"\n                ngf-select="uploadFile($file, $errorFile, $index)"\n                accept="{{form.extensions}}"\n                ng-if="!(modelOne.url && modelOne.url.length === 0)">\n          <i class="glyphicon glyphicon-upload"></i>\n        </button>\n        <button class="btn btn-danger"\n                ng-click="removeModel($index)"\n                data-toggle="tooltip"\n                title="remove">\n          <i class="glyphicon glyphicon-trash"></i>\n        </button>\n      </div>\n    </div>\n    <div class="radio pull-left" ng-show="form.key">\n      <label><input type="radio" name="defaultImage" ng-model="model.default.index" ng-value="$index" ng-disabled="form.readonly"/>Default image</label>\n    </div>\n    <div class="clearfix"></div>\n    <span class="input-group-btn">\n      <button class="btn btn-default" ng-if="hasSuccess() && form.feedback !== false" disabled="disabled">\n        <i class="glyphicon glyphicon-ok" style="color: #3c763d;"></i>\n      </button>\n\n      <button ng-if="form.description" class="btn btn-default"\n              ng-click="tab.show_index = !tab.show_index ? $index : tab.show_index !== $index ? $index : null">\n        <i class="glyphicon glyphicon-question-sign"></i>\n      </button>\n    </span>\n\n\n    <img class="img-thumbnail"\n         ng-show="form.key"\n         ng-src="{{isLocalImgUrl(modelOne.url) ? (modelOne.url + \'/\' + form.preview.width): modelOne.url}}" alt=""\n         width="{{form.preview.width}}"\n         height="{{form.preview.height}}"\n         ng-if="modelOne.url && modelOne.url.length > 0"\n         ng-click="showImageFullSize(modelOne.url)"/><br/>\n    <div ng-if="isLocalImgUrl(modelOne.url)">\n      <button class="btn btn-default" ng-click="turnElement(modelOne.url, -90)"><i class="fa fa-undo" aria-hidden="true"></i>Turn left</button>\n      <button class="btn btn-default" ng-click="turnElement(modelOne.url, 90)"><i class="fa fa-repeat" aria-hidden="true"></i>Turn right</button>\n    </div>\n\n    <div class="progress" ng-if="isUploading[$index]">\n      <div class="progress-bar" role="progressbar" ng-style="{\'width\': uploadProgress + \'%\'}"\n           aria-valuenow="{{uploadProgress}}" aria-valuemin="0" aria-valuemax="100">\n        {{uploadProgress}}%\n      </div>\n    </div>\n  </div>\n\n  <button class="btn btn-primary" ng-click="addModel()" ng-if="!form.readonly">Add</button>\n\n  <button type="file" class="btn btn-default"\n          ngf-select="uploadFiles($files, $errorFiles, $index)" multiple\n          accept="{{form.extensions}}"\n          ng-if="!form.readonly && (!modelOne.url || modelOne.url.length == 0)">\n    <i class="glyphicon glyphicon-plus-sign"></i>&nbsp;<span>Add Image\'s list</span>\n  </button>\n\n</div>')}]),angular.module("imageUrl",["schemaForm","templates","ngFileUpload","ui.bootstrap","ui-notification"]).config(["schemaFormDecoratorsProvider",function(n){n.addMapping("bootstrapDecorator","image-url","src/templates/image-url-plugin.html"),n.addMapping("bootstrapReportDecorator","image-url","src/templates/image-url-plugin.html")}]),angular.module("imageUrl").controller("confirmCtrl",["$scope","$uibModalInstance","options",function(n,e,l){n.title=l.title,n.question=l.question,n.ok=function(){e.close()},n.cancel=function(){e.dismiss("cancel")}}]),angular.module("imageUrl").controller("showImgFullSize",["$scope","$uibModalInstance","options",function(n,e,l){n.title=l.title,n.url=l.url,n.cancel=function(){e.close()},n.download=function(){window.open(n.url)}}]),angular.module("imageUrl").service("imageLoader",["Upload",function(n){return{uploadImage:function(e,l){return n.upload({url:e,data:{file:l}})}}}]),angular.module("imageUrl").controller("imageUrlCtrl",["$scope","imageLoader","Notification","$uibModal",function(n,e,l,o){function i(n,e){for(var l=e.split("."),o=n,i=0;i<l.length;i++){if(!n.hasOwnProperty(l[i]))return null;o=n[e]}return o}function t(n,e){angular.forEach(n,function(n){a(n,null,d())})}function a(o,t,a){o&&n.form.uploadService&&(n.isUploading[a]=!0,n.uploadProgress=0,e.uploadImage(n.form.uploadService.url,o).then(function(e){var l=n.form.uploadService.responsePath,o=i(e.data,l);console.log(o),n.model.images[a].url=(n.form.baseImageUrl||"")+o},function(n){l.error({title:"Errors",message:"File upload unsuccessful"}),console.log(n)},function(e){n.uploadProgress=parseInt(100*e.loaded/e.total)}).finally(function(){n.isUploading[a]=!1}))}function s(n){angular.element(document.querySelector("#file-selector"+n)).click()}function d(){return n.model.images||(n.model.images=[]),n.model.images.push({url:""}),n.model.images.length-1}function r(e){o.open({templateUrl:"src/dialogs/confirm.html",controller:"confirmCtrl",resolve:{options:{title:"Remove element",question:"Do you really want to remove image?"}}}).result.then(function(){n.model.images.splice(e,1),n.model.default&&n.model.default.index===e&&(n.model.default=null)},function(){})}function m(n){o.open({templateUrl:"src/dialogs/show-img.html",controller:"showImgFullSize",resolve:{options:{title:"Image in full size",url:n}}})}function c(e,l){var o=n.model.images[e];if(n.model.default)switch(n.model.default.index){case e:n.model.default.index=e+l;break;case e+l:n.model.default.index=e}n.model.images.splice(e,1),n.model.images.splice(e+l,0,o)}function u(n){return n.startsWith(f)}function g(n,e){var o=n.slice(f.length);$http({method:"GET",url:"ws/img/rotate/"+o+"/"+e}).then(function(e){n=f+e},function(n){l.error({title:"Error",message:"Something went wrong! The image couldn't be turned. Server message: "+n})})}n.addImage=s,n.addModel=d,n.removeModel=r,n.uploadFile=a,n.uploadFiles=t,n.moveElement=c,n.showImageFullSize=m,n.isLocalImgUrl=u,n.turnElement=g,n.isUploading=[];var f="/ws/img/download/";n.model||(n.model={}),n.model.images||(n.model.images=[]),n.model.default||(n.model.default={}),n.$watch("model.default.index",function(){$.isEmptyObject(n.model.default)||!n.model.default&&null==n.model.default||(n.model.default.url=n.model.images[n.model.default.index].url)})}]),angular.module("imageUrl").directive("imageUrl",function(){return{restrict:"E",scope:{form:"=",schema:"=",model:"="},templateUrl:"src/templates/image-url.html",controller:"imageUrlCtrl",link:function(n,e){}}});